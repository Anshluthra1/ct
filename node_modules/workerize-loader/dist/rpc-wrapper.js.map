{"version":3,"file":"rpc-wrapper.js","sources":["../src/rpc-wrapper.js"],"sourcesContent":["export default function addMethods(worker, methods) {\n\tlet c = 0;\n\tlet callbacks = {};\n\tworker.addEventListener('message', (e) => {\n\t\tlet d = e.data;\n\t\tif (d.type!=='RPC') return;\n\t\tif (d.id) {\n\t\t\tlet f = callbacks[d.id];\n\t\t\tif (f) {\n\t\t\t\tdelete callbacks[d.id];\n\t\t\t\tif (d.error) {\n\t\t\t\t\tf[1](Object.assign(Error(d.error.message), d.error));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tf[0](d.result);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tlet evt = document.createEvent('Event');\n\t\t\tevt.initEvent(d.method, false, false);\n\t\t\tevt.data = d.params;\n\t\t\tworker.dispatchEvent(evt);\n\t\t}\n\t});\n\tmethods.forEach( method => {\n\t\tworker[method] = (...params) => new Promise( (a, b) => {\n\t\t\tlet id = ++c;\n\t\t\tcallbacks[id] = [a, b];\n\t\t\tworker.postMessage({ type: 'RPC', id, method, params });\n\t\t});\n\t});\n}\n"],"names":["addMethods","worker","methods","c","callbacks","addEventListener","e","d","data","type","id","f","error","Object","assign","Error","message","result","evt","document","createEvent","initEvent","method","params","dispatchEvent","forEach","Promise","a","b","postMessage"],"mappings":"AAAe,SAASA,UAAT,CAAoBC,MAApB,EAA4BC,OAA5B,EAAqC;AACnD,MAAIC,CAAC,GAAG,CAAR;AACA,MAAIC,SAAS,GAAG,EAAhB;AACAH,EAAAA,MAAM,CAACI,gBAAP,CAAwB,SAAxB,EAAmC,UAACC,CAAD,EAAO;AACzC,QAAIC,CAAC,GAAGD,CAAC,CAACE,IAAV;AACA,QAAID,CAAC,CAACE,IAAF,KAAS,KAAb,EAAoB;;AACpB,QAAIF,CAAC,CAACG,EAAN,EAAU;AACT,UAAIC,CAAC,GAAGP,SAAS,CAACG,CAAC,CAACG,EAAH,CAAjB;;AACA,UAAIC,CAAJ,EAAO;AACN,eAAOP,SAAS,CAACG,CAAC,CAACG,EAAH,CAAhB;;AACA,YAAIH,CAAC,CAACK,KAAN,EAAa;AACZD,UAAAA,CAAC,CAAC,CAAD,CAAD,CAAKE,MAAM,CAACC,MAAP,CAAcC,KAAK,CAACR,CAAC,CAACK,KAAF,CAAQI,OAAT,CAAnB,EAAsCT,CAAC,CAACK,KAAxC,CAAL;AACA,SAFD,MAGK;AACJD,UAAAA,CAAC,CAAC,CAAD,CAAD,CAAKJ,CAAC,CAACU,MAAP;AACA;AACD;AACD,KAXD,MAYK;AACJ,UAAIC,GAAG,GAAGC,QAAQ,CAACC,WAAT,CAAqB,OAArB,CAAV;AACAF,MAAAA,GAAG,CAACG,SAAJ,CAAcd,CAAC,CAACe,MAAhB,EAAwB,KAAxB,EAA+B,KAA/B;AACAJ,MAAAA,GAAG,CAACV,IAAJ,GAAWD,CAAC,CAACgB,MAAb;AACAtB,MAAAA,MAAM,CAACuB,aAAP,CAAqBN,GAArB;AACA;AACD,GArBD;AAsBAhB,EAAAA,OAAO,CAACuB,OAAR,CAAiB,UAAAH,MAAM,EAAI;AAC1BrB,IAAAA,MAAM,CAACqB,MAAD,CAAN,GAAiB;AAAA;AAAA,aAAe,IAAII,OAAJ,CAAa,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACtD,YAAIlB,EAAE,GAAG,EAAEP,CAAX;AACAC,QAAAA,SAAS,CAACM,EAAD,CAAT,GAAgB,CAACiB,CAAD,EAAIC,CAAJ,CAAhB;AACA3B,QAAAA,MAAM,CAAC4B,WAAP,CAAmB;AAAEpB,UAAAA,IAAI,EAAE,KAAR;AAAeC,UAAAA,EAAE,EAAFA,EAAf;AAAmBY,UAAAA,MAAM,EAANA,MAAnB;AAA2BC,UAAAA,MAAM;AAAjC,SAAnB;AACA,OAJ+B,CAAf;AAAA,KAAjB;AAKA,GAND;AAOA;;;;"}